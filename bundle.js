"use strict";function pathReducer(t,e){var n=t.type;if(!n||-1===["ATOM_SET","ATOM_UPDATE","ATOM_REMOVE"].indexOf(n))return e;var r=t.payload,o=r.path;switch("string"===toType(o)&&(o=[o]),n){case"ATOM_SET":return pathSet(o,r.value,e);case"ATOM_UPDATE":var u=r.value,i=pathGet(o,e),a=toType(u);if(a===toType(i)){if("array"===a)return pathSet(o,i.concat(u),e);if("object"===a)return pathSet(o,merge(i,u),e)}return pathSet(o,u,e);case"ATOM_REMOVE":var f=pathGet(o.slice(0,-1),e),c=toType(f);if("object"===c)return pathSet(o.slice(0,-1),without(o.slice(-1),f),e);if("array"===c){var p=last(o);if("number"===toType(p))return f.splice(p,1),pathSet(o.slice(0,-1),f,e)}return pathSet(o,void 0,e);default:return e}}function atom(t,e){function n(){for(var e=arguments.length,n=o(),r=0;r<e;r++)n=u(t,arguments[r],n);f(n)&&i(n)}function r(t,e){if(1===arguments.length){if("function"!=typeof(e=t))throw new c("listener must be a function");s.push(e)}else 2===arguments.length&&a(t,e)}function o(){return"object"===(void 0===l?"undefined":_typeof(l))?merge({},l):l}function u(t,e,n){for(var r=n,o=void 0,u=0;u<p;u++)f(o=t[u](e,r))&&(r=o);return r}function i(t){l=t;for(var e=0;e<s.length;e++)s[e]()}function a(t,e){var n=t.join(","),u=pathGet(t),i=function(){var t=u(o());if(void 0!==t){var r=h[n];void 0!==r&&r===t||("object"===toType(t)?h[n]=merge({},t):h[n]=t,e(t,r))}};i(),r(i)}function f(t){if(void 0===t)throw new c("Reducer must return a value.");if("function"==typeof t.then)throw new c("Reducer cannot return a Promise.");if("function"!=typeof t)return!0;t(n)}function c(t){this.message=t,this.name="AtomException",this.toString=function(){return this.name+": "+this.message}}t&&void 0===e?(e=t,t=[]):"function"==typeof t&&(t=[t]),t.push(pathReducer);var p=t.length,s=[],h={},l=e;return{dispatch:n,subscribe:r,unsubscribe:function(t){if(t){var e=s.length;if(0!==e)for(var n=0;n<e;n++)t===s[n]&&s.splice(n,1)}},getState:o,set:function(t,e){return{type:"ATOM_SET",payload:{path:t,value:e}}},update:function(t,e){return{type:"ATOM_UPDATE",payload:{path:t,value:e}}},remove:function(t){return{type:"ATOM_REMOVE",payload:{path:t}}}}}function merge(){if(arguments&&arguments.length){for(var t={},e=0;e<arguments.length;e++){if("object"!==toType(arguments[e]))throw new TypeError("All arguments must be objects");t=_extends({},t,arguments[e])}return t}}function pathGet(t,e){for(var n=e,r=0;r<t.length;r++){if(null==n)return;n=n[t[r]]}return n}function pathSet(t,e,n){var r=merge({},n);return t.reduce(function(n,r,o){return n[r]=n[r]||{},t.length===o+1&&(n[r]=e),n[r]},r),r}function pick(t,e){for(var n={},r=0;r<t.length;r++){var o=t[r];e[o]&&(n[o]=e[o])}return n}function without(t,e){return pick(Object.keys(e).filter(function(e){return-1===t.indexOf(e)}),e)}function last(t){return t[t.length?t.length-1:0]}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};module.exports=atom;
