"use strict";function pathReducer(e,t){var r=e.type;if(!r||-1===["ATOM_SET","ATOM_UPDATE","ATOM_REMOVE"].indexOf(r))return t;var n=e.payload,o=n.path;switch("string"===toType(o)&&(o=[o]),r){case"ATOM_SET":return pathSet(o,n.value,t);case"ATOM_UPDATE":var a=n.value,i=pathGet(o,t),c=toType(a);if(c===toType(i)){if("array"===c)return pathSet(o,i.concat(a),t);if("object"===c)return pathSet(o,merge(i,a),t)}return pathSet(o,a,t);case"ATOM_REMOVE":var u=pathGet(o.slice(0,-1),t),p=toType(u);if("object"===p)return pathSet(o.slice(0,-1),without(o.slice(-1),u),t);if("array"===p){var f=last(o);if("number"===toType(f))return u.splice(f,1),pathSet(o.slice(0,-1),u,t)}return pathSet(o,void 0,t);default:return t}}function atom(e,t){function r(){for(var t=arguments.length,r=o(),n=0;n<t;n++)r=a(e,arguments[n],r);u(r)&&i(r)}function n(e,t){if(1===arguments.length){if("function"!=typeof(t=e))throw new p("listener must be a function");h.push(t)}else 2===arguments.length&&c(e,t)}function o(){return"object"===toType(y)?merge({},y):y}function a(e,t,r){for(var n=r,o=void 0,a=0;a<f;a++)u(o=e[a](t,n))&&(n=o);return n}function i(e){y=e;for(var t=0;t<h.length;t++)h[t]()}function c(e,t){var r=e.join(","),a=pathGet(e),i=function(){var e=a(o());if(void 0!==e){var n=s[r];void 0!==n&&n===e||("object"===toType(e)?s[r]=merge({},e):s[r]=e,t(e,n))}};i(),n(i)}function u(e){if(void 0===e)throw new p("Reducer must return a value.");if("function"==typeof e.then)throw new p("Reducer cannot return a Promise.");if("function"!=typeof e)return!0;e(r)}function p(e){this.message=e,this.name="AtomException",this.toString=function(){return this.name+": "+this.message}}e&&void 0===t?(t=e,e=[]):"function"==typeof e&&(e=[e]),e.push(pathReducer);var f=e.length,h=[],s={},y=t;return{dispatch:r,subscribe:n,unsubscribe:function(e){if(e){var t=h.length;if(0!==t)for(var r=0;r<t;r++)e===h[r]&&h.splice(r,1)}},getState:o,set:function(e,t){return{type:"ATOM_SET",payload:{path:e,value:t}}},update:function(e,t){return{type:"ATOM_UPDATE",payload:{path:e,value:t}}},remove:function(e){return{type:"ATOM_REMOVE",payload:{path:e}}}}}function merge(){if(arguments&&arguments.length){for(var e={},t=0;t<arguments.length;t++){if("object"!==toType(arguments[t]))throw new TypeError("All arguments must be objects");e=_extends({},e,arguments[t])}return e}}function pathGet(e,t){checkArgTypes_1(arguments,["array",["array","object"]]);for(var r=t,n=0;n<e.length;n++){if(null==r)return;r=r[e[n]]}return r}function pathSet(e,t,r){checkArgTypes_1(arguments,["array","-any","object"]);var n=merge({},r);return e.reduce(function(r,n,o){return r[n]=r[n]||{},e.length===o+1&&(r[n]=t),r[n]},n),n}function pick(e,t){checkArgTypes_1(arguments,["array","object"]);for(var r={},n=0;n<e.length;n++){var o=e[n];t[o]&&(r[o]=t[o])}return r}function without(e,t){return pick(Object.keys(t).filter(function(t){return-1===e.indexOf(t)}),t)}function last(e){return checkArgTypes_1([arguments[0]],["array"]),e[e.length?e.length-1:0]}var toType$1=function(e){return{}.toString.call(e).toLowerCase().slice(8,-1)},checkArgTypes=function(e,t){for(var r,n,o=0,a=(e=Array.prototype.slice.call(e)).length;o<a;++o)if(r=toType$1(e[o]),"-any"!==(n=t[o]))if("array"===toType$1(n)){for(var i=!1,c=0,u=n.length;c<u;++c)i=i||r===n[c];if(!i)throw new TypeError("Expected one of ["+n.join(", ")+"] given '"+r+"' for argument at index "+o)}else if(r!==n)throw new TypeError("Expected '"+n+"' given '"+r+"' for argument at index "+o)};checkArgTypes.prototype.toType=toType$1;var checkArgTypes_1=checkArgTypes,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},toType=checkArgTypes_1.prototype.toType;module.exports=atom;
