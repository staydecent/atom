"use strict";function pathReducer(t,e){var r=t.type;if(!r||-1===["ATOM_SET","ATOM_UPDATE","ATOM_REMOVE"].indexOf(r))return e;var n=t.payload,o=n.path;switch("string"===toType(o)&&(o=[o]),r){case"ATOM_SET":return pathSet(o,n.value,e);case"ATOM_UPDATE":var a=n.value,i=pathGet(o,e),c=toType(a);if(c===toType(i)){if("array"===c)return pathSet(o,i.concat(a),e);if("object"===c)return pathSet(o,merge(i,a),e)}return pathSet(o,a,e);case"ATOM_REMOVE":var u=pathGet(o.slice(0,-1),e),p=toType(u);if("object"===p)return pathSet(o.slice(0,-1),without(o.slice(-1),u),e);if("array"===p){var f=last(o);if("number"===toType(f))return u.splice(f,1),pathSet(o.slice(0,-1),u,e)}return pathSet(o,void 0,e);default:return e}}function atom(t,e){function r(){for(var e=arguments.length,r=n(),c=0;c<e;c++)r=o(t,arguments[c],r);i(r)&&a(r)}function n(){return"object"===(void 0===f?"undefined":_typeof(f))?Object.hasOwnProperty("assign")?Object.assign({},f):JSON.parse(JSON.stringify(f)):f}function o(t,e,r){for(var n=r,o=void 0,a=0;a<u;a++)i(o=t[a](e,n))&&(n=o);return n}function a(t){f=t;for(var e=0;e<p.length;e++)p[e]()}function i(t){if(void 0===t)throw new c("Reducer must return a value.");if("function"==typeof t.then)throw new c("Reducer cannot return a Promise.");if("function"!=typeof t)return!0;t(r)}function c(t){this.message=t,this.name="AtomException",this.toString=function(){return this.name+": "+this.message}}t&&void 0===e?(e=t,t=[]):"function"==typeof t&&(t=[t]),t.push(pathReducer);var u=t.length,p=[],f=e;return{dispatch:r,subscribe:function(t){if("function"!=typeof t)throw new c("listener must be a function");p.push(t)},unsubscribe:function(t){if(t){var e=p.length;if(0!==e)for(var r=0;r<e;r++)t===p[r]&&p.splice(r,1)}},getState:n,set:function(t,e){return{type:"ATOM_SET",payload:{path:t,value:e}}},update:function(t,e){return{type:"ATOM_UPDATE",payload:{path:t,value:e}}},remove:function(t){return{type:"ATOM_REMOVE",payload:{path:t}}}}}function merge(){if(arguments&&arguments.length){for(var t={},e=0;e<arguments.length;e++){if("object"!==toType(arguments[e]))throw new TypeError("All arguments must be objects");t=_extends({},t,arguments[e])}return t}}function pathGet(t,e){checkArgTypes_1(arguments,["array",["array","object"]]);for(var r=e,n=0;n<t.length;n++){if(null==r)return;r=r[t[n]]}return r}function pathSet(t,e,r){checkArgTypes_1(arguments,["array","-any","object"]);var n=merge({},r);return t.reduce(function(r,n,o){return r[n]=r[n]||{},t.length===o+1&&(r[n]=e),r[n]},n),n}function pick(t,e){checkArgTypes_1(arguments,["array","object"]);for(var r={},n=0;n<t.length;n++){var o=t[n];e[o]&&(r[o]=e[o])}return r}function without(t,e){return pick(Object.keys(e).filter(function(e){return-1===t.indexOf(e)}),e)}function last(t){return checkArgTypes_1([arguments[0]],["array"]),t[t.length?t.length-1:0]}var toType$1=function(t){return{}.toString.call(t).toLowerCase().slice(8,-1)},checkArgTypes=function(t,e){for(var r,n,o=0,a=(t=Array.prototype.slice.call(t)).length;o<a;++o)if(r=toType$1(t[o]),"-any"!==(n=e[o]))if("array"===toType$1(n)){for(var i=!1,c=0,u=n.length;c<u;++c)i=i||r===n[c];if(!i)throw new TypeError("Expected one of ["+n.join(", ")+"] given '"+r+"' for argument at index "+o)}else if(r!==n)throw new TypeError("Expected '"+n+"' given '"+r+"' for argument at index "+o)};checkArgTypes.prototype.toType=toType$1;var checkArgTypes_1=checkArgTypes,_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},toType=checkArgTypes_1.prototype.toType;module.exports=atom;
